<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <title>Perfil Administrador</title>
</head>
<body>

<header>
    <h1>BlockFile</h1>
    <a class="btn" href="{% url 'users:perfil_admin' %}">Perfil</a>
    <a class="btn" href="{% url 'gestorProductos:gestion' %}">Inventario</a>
    <a class="btn" href="{% url 'gestorCategorias:gestion' %}">Categorias</a>
    <a class="btn" href="{% url 'gestorUsuario:gestion' %}">Usuarios</a>
</header>

<h1>Perfil del Administrador</h1>

{% if errors %}
    <div>
        <strong>Errores:</strong>
        <pre>{{ errors }}</pre>
    </div>
{% endif %}

{% if success %}
    <div>
        <strong>{{ success }}</strong>
    </div>
{% endif %}

<form id="form-admin" method="post" action="">
    {% csrf_token %}
    <div>
        <label>ID:</label><br>
        <input type="text" value="{{ request.session.usuario_id }}" disabled>
    </div>

    <div>
        <label>Nombre:</label><br>
        <input id="inp-nombre" type="text" name="nombre" maxlength="10" value="{{ request.session.usuario_nombre }}"
               readonly required>
    </div>

    <div>
        <label>Correo:</label><br>
        <input id="inp-correo" type="email" name="correo" maxlength="50" value="{{ request.session.usuario_correo }}"
               readonly required>
    </div>

    <div>
        <label>Contrasena:</label><br>
        <input id="inp-contrasena" type="password" name="contrasena" minlength="4"
               value="{{ request.session.usuario_contrasena }}" readonly required>
    </div>


    <div style="margin-top: 10px;">
        <button id="btn-editar" type="button">Editar información</button>
        <button id="btn-guardar" type="submit" style="display:none;">Guardar</button>
        <button id="btn-cancelar" type="button" style="display:none;">Cancelar</button>
    </div>
</form>

<form method="post" action="{% url 'users:logout' %}" style="margin-top: 12px;">
    {% csrf_token %}
    <button type="submit">Cerrar sesión</button>
</form>

<script>
    (() => {
        const $ = id => document.getElementById(id);

        const form = $('form-admin');
        const nombre = $('inp-nombre');
        const correo = $('inp-correo');
        const pass = $('inp-contrasena');

        const btnEdit = $('btn-editar');
        const btnSave = $('btn-guardar');
        const btnCancel = $('btn-cancelar');

        const original = {
            nombre: nombre.value,
            correo: correo.value,
            pass: pass.value
        };

        function setMode(edit) {
            [nombre, correo, pass].forEach(i => i.readOnly = !edit);
            btnEdit.style.display = edit ? 'none' : '';
            btnSave.style.display = edit ? '' : 'none';
            btnCancel.style.display = edit ? '' : 'none';
        }

        btnEdit.onclick = () => {
            setMode(true);
            nombre.focus();
        };
        btnCancel.onclick = () => {
            nombre.value = original.nombre;
            correo.value = original.correo;
            pass.value = original.pass;
            setMode(false);
        };

        // (opcional) al enviar no hacemos nada extra: el servidor valida y responde
        form.addEventListener('submit', () => setMode(false));
    })();
</script>
</body>
</html>
